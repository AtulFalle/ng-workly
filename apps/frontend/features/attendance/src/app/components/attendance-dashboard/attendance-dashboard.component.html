<!-- Attendance Management Dashboard -->
<div class="attendance-dashboard">
  <!-- Header Section -->
  <div class="dashboard-header">
    <h1 class="dashboard-title">Attendance Management</h1>
    <p class="dashboard-subtitle">{{ getCurrentDate() }}</p>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <p-card class="stat-card">
      <ng-template pTemplate="header">
        <div class="stat-card__icon stat-card__icon--primary">
          <i class="pi pi-users"></i>
        </div>
      </ng-template>
      
      <div class="stat-card__content">
        <h3 class="stat-card__value">{{ attendanceStats().totalEmployees }}</h3>
        <p class="stat-card__label">Total Employees</p>
      </div>
    </p-card>

    <p-card class="stat-card">
      <ng-template pTemplate="header">
        <div class="stat-card__icon stat-card__icon--success">
          <i class="pi pi-check-circle"></i>
        </div>
      </ng-template>
      
      <div class="stat-card__content">
        <h3 class="stat-card__value">{{ attendanceStats().presentToday }}</h3>
        <p class="stat-card__label">Present Today</p>
      </div>
    </p-card>

    <p-card class="stat-card">
      <ng-template pTemplate="header">
        <div class="stat-card__icon stat-card__icon--danger">
          <i class="pi pi-times-circle"></i>
        </div>
      </ng-template>
      
      <div class="stat-card__content">
        <h3 class="stat-card__value">{{ attendanceStats().absentToday }}</h3>
        <p class="stat-card__label">Absent Today</p>
      </div>
    </p-card>

    <p-card class="stat-card">
      <ng-template pTemplate="header">
        <div class="stat-card__icon stat-card__icon--warning">
          <i class="pi pi-clock"></i>
        </div>
      </ng-template>
      
      <div class="stat-card__content">
        <h3 class="stat-card__value">{{ attendanceStats().lateToday }}</h3>
        <p class="stat-card__label">Late Today</p>
      </div>
    </p-card>

    <p-card class="stat-card">
      <ng-template pTemplate="header">
        <div class="stat-card__icon stat-card__icon--info">
          <i class="pi pi-chart-line"></i>
        </div>
      </ng-template>
      
      <div class="stat-card__content">
        <h3 class="stat-card__value">{{ attendanceStats().averageHours }}h</h3>
        <p class="stat-card__label">Avg Hours</p>
      </div>
    </p-card>

    <p-card class="stat-card">
      <ng-template pTemplate="header">
        <div class="stat-card__icon stat-card__icon--secondary">
          <i class="pi pi-percentage"></i>
        </div>
      </ng-template>
      
      <div class="stat-card__content">
        <h3 class="stat-card__value">{{ attendanceStats().attendanceRate }}%</h3>
        <p class="stat-card__label">Attendance Rate</p>
      </div>
    </p-card>
  </div>

  <!-- Main Content Grid -->
  <div class="dashboard-grid">
    <!-- Check-in/Check-out Section -->
    <div class="dashboard-column dashboard-column--left">
      <p-card class="checkin-card">
        <ng-template pTemplate="header">
          <div class="card-header">
            <h2 class="card-title">My Attendance</h2>
            <p-badge 
              [value]="getStatusLabel(currentUserAttendance()?.status || 'absent')" 
              [severity]="getStatusSeverity(currentUserAttendance()?.status || 'absent')"
              size="small">
            </p-badge>
          </div>
        </ng-template>

        @if (userAttendanceLoading()) {
          <div class="loading-state">
            <i class="pi pi-spinner pi-spin"></i>
            <p>Loading attendance data...</p>
          </div>
        } @else if (currentUserAttendance()) {
          <div class="attendance-details">
            <div class="attendance-row">
              <span class="attendance-label">Check-in:</span>
              <span class="attendance-value">{{ formatTime(currentUserAttendance()!.checkIn) }}</span>
            </div>
            <div class="attendance-row">
              <span class="attendance-label">Check-out:</span>
              <span class="attendance-value">{{ formatTime(currentUserAttendance()!.checkOut) }}</span>
            </div>
            <div class="attendance-row">
              <span class="attendance-label">Total Hours:</span>
              <span class="attendance-value">{{ formatDuration(currentUserAttendance()!.totalHours) }}</span>
            </div>
            @if (currentUserAttendance()!.location) {
              <div class="attendance-row">
                <span class="attendance-label">Location:</span>
                <span class="attendance-value">{{ currentUserAttendance()!.location }}</span>
              </div>
            }
          </div>

          <p-divider></p-divider>

          <div class="checkin-actions">
            @if (canCheckIn()) {
              <p-button 
                label="Check In" 
                icon="pi pi-sign-in"
                [loading]="isCheckingIn()"
                (onClick)="handleCheckIn()"
                class="checkin-button">
              </p-button>
            }
            
            @if (canCheckOut()) {
              <p-button 
                label="Check Out" 
                icon="pi pi-sign-out"
                [loading]="isCheckingOut()"
                (onClick)="handleCheckOut()"
                class="checkout-button">
              </p-button>
            }
          </div>
        }
      </p-card>
    </div>

    <!-- Today's Attendance Overview -->
    <div class="dashboard-column dashboard-column--right">
      <p-card class="attendance-overview">
        <ng-template pTemplate="header">
          <div class="card-header">
            <h2 class="card-title">Today's Attendance</h2>
            <p-button 
              label="View All" 
              icon="pi pi-list"
              [text]="true"
              size="small"
              (onClick)="handleViewAttendance()">
            </p-button>
          </div>
        </ng-template>

        @if (attendanceLoading()) {
          <div class="loading-state">
            <i class="pi pi-spinner pi-spin"></i>
            <p>Loading attendance data...</p>
          </div>
        } @else {
          <div class="attendance-list">
            @for (record of todayAttendance(); track record.id) {
              <div class="attendance-item">
                <div class="attendance-item__info">
                  <h4 class="attendance-item__name">{{ record.employeeName }}</h4>
                  <p class="attendance-item__id">{{ record.employeeId }}</p>
                </div>
                
                <div class="attendance-item__times">
                  <div class="time-row">
                    <span class="time-label">In:</span>
                    <span class="time-value">{{ formatTime(record.checkIn) }}</span>
                  </div>
                  <div class="time-row">
                    <span class="time-label">Out:</span>
                    <span class="time-value">{{ formatTime(record.checkOut) }}</span>
                  </div>
                  <div class="time-row">
                    <span class="time-label">Hours:</span>
                    <span class="time-value">{{ formatDuration(record.totalHours) }}</span>
                  </div>
                </div>

                <div class="attendance-item__status">
                  <p-badge 
                    [value]="getStatusLabel(record.status)" 
                    [severity]="getStatusSeverity(record.status)"
                    size="small">
                  </p-badge>
                </div>
              </div>
            }
          </div>
        }
      </p-card>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <p-card class="actions-card">
      <ng-template pTemplate="header">
        <h2 class="card-title">Quick Actions</h2>
      </ng-template>

      <div class="actions-grid">
        <p-button 
          label="View Attendance List" 
          icon="pi pi-list"
          [outlined]="true"
          routerLink="list">
        </p-button>
        
        <p-button 
          label="View Reports" 
          icon="pi pi-chart-bar"
          [outlined]="true"
          routerLink="reports">
        </p-button>
        
        <p-button 
          label="Regularization" 
          icon="pi pi-calendar-plus"
          [outlined]="true"
          routerLink="regularization">
        </p-button>
        
        <p-button 
          label="Export Data" 
          icon="pi pi-download"
          [outlined]="true"
          (onClick)="handleExportData()">
        </p-button>
      </div>
    </p-card>
  </div>
</div>

<p-toast></p-toast>
