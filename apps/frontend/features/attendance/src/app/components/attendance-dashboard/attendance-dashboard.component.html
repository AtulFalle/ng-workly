<!-- Attendance Management Dashboard -->
<div class="attendance-dashboard">
  <!-- Top Section: Punch Card and Stats -->
  <div class="dashboard-grid">
    <!-- Left Column: Attendance Punch Card -->
    <div class="dashboard-column dashboard-column-punch-card">
      <lib-attendance-punch-card
        [data]="attendancePunchCardData()"
        [config]="attendancePunchCardConfig"
        [loading]="userAttendanceLoading()"
        [showActions]="true"
        (checkIn)="onPunchCardCheckIn()"
        (checkOut)="onPunchCardCheckOut()">
      </lib-attendance-punch-card>
    </div>

    <!-- Right Column: Stats Cards -->
    <div class="dashboard-column dashboard-column-stats">
      <div class="stats-grid">
        <lib-stat-card 
          title="Total Employees" 
          [value]="attendanceStats().totalEmployees" 
          icon="pi pi-users"
          variant="primary" 
          size="medium" 
          subtitle="Active employees" 
          [loading]="statsLoading()">
        </lib-stat-card>

        <lib-stat-card 
          title="Present Today" 
          [value]="attendanceStats().presentToday" 
          icon="pi pi-check-circle"
          variant="success" 
          size="medium" 
          subtitle="{{ attendanceStats().attendanceRate }}% attendance rate"
          [loading]="statsLoading()">
        </lib-stat-card>

        <lib-stat-card 
          title="Absent Today" 
          [value]="attendanceStats().absentToday" 
          icon="pi pi-times-circle"
          variant="danger" 
          size="medium" 
          subtitle="Not checked in" 
          [loading]="statsLoading()">
        </lib-stat-card>

        <lib-stat-card 
          title="Late Today" 
          [value]="attendanceStats().lateToday" 
          icon="pi pi-clock" 
          variant="warning"
          size="medium" 
          subtitle="Arrived after 9:00 AM" 
          [loading]="statsLoading()">
        </lib-stat-card>

        <lib-stat-card 
          title="Avg Hours" 
          [value]="attendanceStats().averageHours + 'h'" 
          icon="pi pi-hourglass"
          variant="info" 
          size="medium" 
          subtitle="Daily average" 
          [loading]="statsLoading()">
        </lib-stat-card>
      </div>
    </div>
  </div>

  <!-- Today's Attendance Overview -->
  <lib-card title="Today's Attendance" subtitle="Real-time attendance overview" shadow="md">
    <div class="card-header-content">
      <lib-button 
        label="View All" 
        icon="pi pi-list" 
        size="small" 
        severity="secondary" 
        [text]="true"
        routerLink="list">
      </lib-button>
    </div>

    @if (attendanceLoading()) {
      <div class="loading-state">
        <i class="pi pi-spinner pi-spin"></i>
        <p>Loading attendance data...</p>
      </div>
    } @else {
      <lib-table
        [columns]="attendanceTableColumns"
        [rows]="attendanceTableRows()"
        [config]="attendanceTableConfig"
        variant="attendance"
        size="medium"
        [loading]="attendanceLoading()"
        (rowClick)="onAttendanceRowClick($event)">
      </lib-table>
    }
  </lib-card>

  <!-- Main Content Grid: Charts -->
  <div class="dashboard-grid">
    <!-- Left Column -->
    <div class="dashboard-column">
      <!-- Weekly Attendance Chart -->
      <lib-card 
        title="Weekly Attendance Trend" 
        subtitle="Present, Absent, and Late employees for the week" 
        shadow="md">
        <div class="chart-container">
          <lib-chart 
            type="bar" 
            [data]="weeklyAttendanceChartData()" 
            [options]="weeklyAttendanceChartOptions"
            height="300px">
          </lib-chart>
        </div>
      </lib-card>
    </div>

    <!-- Right Column -->
    <div class="dashboard-column">
      <!-- Monthly Attendance Trend -->
      <lib-card 
        title="Monthly Attendance Trend" 
        subtitle="Attendance rate over the last 6 months" 
        shadow="md">
        <div class="chart-container">
          <lib-chart 
            type="line" 
            [data]="monthlyAttendanceChartData()" 
            [options]="monthlyAttendanceChartOptions"
            height="300px">
          </lib-chart>
        </div>
      </lib-card>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="dashboard-grid-secondary">
    <!-- Department Attendance Distribution -->
    <lib-card title="Department Attendance Distribution" subtitle="Present employees by department" shadow="md">
      <div class="chart-container">
        <lib-chart type="pie" [data]="departmentAttendanceChartData()" [options]="departmentAttendanceChartOptions"
          height="350px">
        </lib-chart>
      </div>
    </lib-card>

    <!-- Check-in Time Distribution -->
    <lib-card title="Check-in Time Distribution" subtitle="Employee check-ins by time slot" shadow="md">
      <div class="chart-container">
        <lib-chart type="bar" [data]="checkInTimeChartData()" [options]="checkInTimeChartOptions" height="350px">
        </lib-chart>
      </div>
    </lib-card>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions-section">
    <div class="section-header">
      <div>
        <h2>Quick Actions</h2>
        <p>Frequently used attendance management actions</p>
      </div>
    </div>
    <div class="actions-grid">
      <lib-card shadow="md">
        <div class="action-card-content">
          <div class="action-card-icon action-card-icon--primary">
            <i class="pi pi-list"></i>
          </div>
          <div class="action-card-body">
            <h3>View Attendance List</h3>
            <p>View and manage all attendance records</p>
          </div>
          <lib-button label="View List" icon="pi pi-arrow-right" size="small" severity="primary" [outlined]="true"
            routerLink="list">
          </lib-button>
        </div>
      </lib-card>

      <lib-card shadow="md">
        <div class="action-card-content">
          <div class="action-card-icon action-card-icon--info">
            <i class="pi pi-chart-bar"></i>
          </div>
          <div class="action-card-body">
            <h3>View Reports</h3>
            <p>Generate and view attendance reports</p>
          </div>
          <lib-button label="View Reports" icon="pi pi-arrow-right" size="small" severity="primary" [outlined]="true"
            routerLink="reports">
          </lib-button>
        </div>
      </lib-card>

      <lib-card shadow="md">
        <div class="action-card-content">
          <div class="action-card-icon action-card-icon--warning">
            <i class="pi pi-calendar-plus"></i>
          </div>
          <div class="action-card-body">
            <h3>Regularization</h3>
            <p>Request attendance regularization</p>
          </div>
          <lib-button label="Request" icon="pi pi-arrow-right" size="small" severity="primary" [outlined]="true"
            routerLink="regularization">
          </lib-button>
        </div>
      </lib-card>

      <lib-card shadow="md">
        <div class="action-card-content">
          <div class="action-card-icon action-card-icon--success">
            <i class="pi pi-calendar-minus"></i>
          </div>
          <div class="action-card-body">
            <h3>Request Leave</h3>
            <p>Submit a new leave request</p>
          </div>
          <lib-button label="Request Leave" icon="pi pi-arrow-right" size="small" severity="primary" [outlined]="true"
            routerLink="leave-request">
          </lib-button>
        </div>
      </lib-card>

      <lib-card shadow="md">
        <div class="action-card-content">
          <div class="action-card-icon action-card-icon--danger">
            <i class="pi pi-check-circle"></i>
          </div>
          <div class="action-card-body">
            <h3>Approve Leave</h3>
            <p>Review and approve leave requests</p>
          </div>
          <lib-button label="Approve" icon="pi pi-arrow-right" size="small" severity="primary" [outlined]="true"
            routerLink="leave-approval">
          </lib-button>
        </div>
      </lib-card>

      <lib-card shadow="md">
        <div class="action-card-content">
          <div class="action-card-icon action-card-icon--secondary">
            <i class="pi pi-download"></i>
          </div>
          <div class="action-card-body">
            <h3>Export Data</h3>
            <p>Export attendance data to Excel/PDF</p>
          </div>
          <lib-button label="Export" icon="pi pi-download" size="small" severity="primary" [outlined]="true"
            (clickEvent)="handleExportData()">
          </lib-button>
        </div>
      </lib-card>
    </div>
  </div>
</div>