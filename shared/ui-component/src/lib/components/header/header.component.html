<!-- HRM-Next Inspired Header Component -->
<header class="header-container">
  <!-- Left Section -->
  <div class="header-left">
    <lib-button
      icon="pi pi-bars"
      size="small"
      [text]="true"
      (clickEvent)="handleToggleSidebar()"
      [attr.aria-label]="'Toggle sidebar'">
    </lib-button>
    
    <div class="header-title">
      <h1 class="title">{{ title() }}</h1>
      @if (subtitle()) {
        <p class="subtitle">{{ subtitle() }}</p>
      }
    </div>
  </div>

  <!-- Center Section - Search -->
  @if (showSearch()) {
    <div class="header-center">
      <lib-input
        type="text"
        placeholder="Search..."
        size="medium"
        iconLeft="pi pi-search"
        [value]="searchQueryValue()"
        (valueChange)="onSearchInputChange($event)">
      </lib-input>
    </div>
  }

  <!-- Right Section -->
  <div class="header-right">
    <!-- Notifications -->
    @if (showNotifications()) {
      <div class="notification-container">
        <lib-button
          icon="pi pi-bell"
          size="small"
          [text]="true"
          [badge]="getUnreadNotificationCount() > 0 ? getUnreadNotificationCount().toString() : undefined"
          (clickEvent)="toggleNotificationMenu()"
          [class.active]="isNotificationMenuOpen()"
          [attr.aria-label]="'Notifications'">
        </lib-button>

        <!-- Notification Dropdown -->
        @if (isNotificationMenuOpen()) {
          <div class="notification-dropdown">
            <div class="notification-header">
              <h3>Notifications</h3>
              <lib-button
                label="Mark all read"
                size="small"
                [text]="true"
                severity="secondary">
              </lib-button>
            </div>
            <div class="notification-list">
              @if (notifications().length === 0) {
                <div class="no-notifications">
                  <i class="pi pi-bell-slash"></i>
                  <p>No notifications</p>
                </div>
              } @else {
                @for (notification of notifications(); track notification.id) {
                  <div 
                    class="notification-item"
                    [class.unread]="!notification.read"
                    (click)="handleNotificationClick(notification)"
                    (keydown.enter)="handleNotificationClick(notification)"
                    (keydown.space)="handleNotificationClick(notification)"
                    tabindex="0"
                    role="button"
                    [attr.aria-label]="'View ' + notification.title + ' notification'">
                    <div class="notification-icon" [class]="'type-' + notification.type">
                      <i class="pi" [class]="{
                        'pi-info-circle': notification.type === 'info',
                        'pi-check-circle': notification.type === 'success',
                        'pi-exclamation-triangle': notification.type === 'warning',
                        'pi-times-circle': notification.type === 'error'
                      }"></i>
                    </div>
                    <div class="notification-content">
                      <h4 class="notification-title">{{ notification.title }}</h4>
                      <p class="notification-message">{{ notification.message }}</p>
                      <span class="notification-time">{{ formatTimestamp(notification.timestamp) }}</span>
                    </div>
                  </div>
                }
              }
            </div>
          </div>
        }
      </div>
    }

    <!-- User Menu -->
    @if (showUserMenu() && userProfile()) {
      <div class="user-menu-container">
        <lib-user-card
          [user]="{
            name: userProfile()!.name,
            subtitle: userProfile()!.role,
            avatar: userProfile()!.avatar,
            email: userProfile()!.email
          }"
          variant="header"
          size="small"
          [clickable]="true"
          (cardClick)="toggleUserMenu()"
          [class.active]="isUserMenuOpen()">
        </lib-user-card>

        <!-- User Dropdown -->
        @if (isUserMenuOpen()) {
          <div class="user-dropdown">
            <div class="user-dropdown-header">
              <lib-user-card
                [user]="{
                  name: userProfile()!.name,
                  subtitle: userProfile()!.role,
                  avatar: userProfile()!.avatar,
                  email: userProfile()!.email
                }"
                variant="default"
                size="medium">
              </lib-user-card>
            </div>
            <div class="user-dropdown-menu">
              <lib-button
                label="Profile"
                icon="pi pi-user"
                size="small"
                [text]="true"
                severity="secondary"
                (clickEvent)="navigateToProfile()">
              </lib-button>
              <lib-button
                label="Settings"
                icon="pi pi-cog"
                size="small"
                [text]="true"
                severity="secondary"
                (clickEvent)="navigateToSettings()">
              </lib-button>
              <lib-button
                label="Help"
                icon="pi pi-question-circle"
                size="small"
                [text]="true"
                severity="secondary"
                (clickEvent)="navigateToHelp()">
              </lib-button>
              <div class="dropdown-divider"></div>
              <lib-button
                label="Logout"
                icon="pi pi-sign-out"
                size="small"
                [text]="true"
                severity="danger"
                (clickEvent)="handleLogout()">
              </lib-button>
            </div>
          </div>
        }
      </div>
    }
  </div>
</header>