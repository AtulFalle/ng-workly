<!-- Sidebar Container -->
<div 
  class="sidebar-container"
  [class.collapsed]="collapsed()"
  [class.dark-theme]="theme() === 'dark'"
  [class.right-position]="position() === 'right'"
  [style.width]="collapsed() ? collapsedWidth() : width()"
>
  <!-- Navigation Sections -->
  <div class="sidebar-content">
    @for (section of displaySections(); track section.title) {
      @if (section.visible !== false) {
        <div class="sidebar-section">
          <!-- Section Header -->
          @if (section.title && !collapsed()) {
            <div 
              class="section-header"
              (click)="onSectionToggle(section)"
              (keydown.enter)="onSectionToggle(section)"
              (keydown.space)="onSectionToggle(section)"
              tabindex="0"
              role="button"
              [attr.aria-label]="'Toggle ' + section.title + ' section'"
              [class.expandable]="section.items.length > 0"
            >
              <span class="section-title">{{ section.title }}</span>
              @if (section.items.length > 0) {
                <i 
                  class="pi section-toggle-icon"
                  [class.pi-chevron-down]="isSectionExpanded(section)"
                  [class.pi-chevron-right]="!isSectionExpanded(section)"
                ></i>
              }
            </div>
          }
          
          <!-- Section Items -->
          @if (!section.title || isSectionExpanded(section) || collapsed()) {
            <div class="section-items">
              @for (item of section.items; track item.label) {
                @if (item.separator) {
                  <div class="menu-separator"></div>
                } @else if (item.visible !== false) {
                  <a 
                    class="menu-item"
                    [class.active]="activeMenuItem() === (item.routerLink || item.label)"
                    [class.disabled]="item.disabled"
                    [routerLink]="item.routerLink"
                    [routerLinkActive]="'active'"
                    (click)="!item.disabled && onMenuClick(item)"
                    [attr.aria-disabled]="item.disabled">
                    @if (item.icon) {
                      <i [class]="'pi ' + item.icon" class="menu-icon"></i>
                    }
                    @if (!collapsed()) {
                      <span class="menu-label">{{ item.label }}</span>
                      @if (item.badge) {
                        <span class="menu-badge">{{ item.badge }}</span>
                      }
                    }
                  </a>
                  
                  <!-- Submenu Items -->
                  @if (item.items && item.items.length > 0 && !collapsed()) {
                    <div class="submenu">
                      @for (subItem of item.items; track subItem.label) {
                        <a 
                          class="submenu-item"
                          [class.active]="activeMenuItem() === (subItem.routerLink || subItem.label)"
                          [class.disabled]="subItem.disabled"
                          [routerLink]="subItem.routerLink"
                          [routerLinkActive]="'active'"
                          (click)="!subItem.disabled && onMenuClick(subItem)"
                          [attr.aria-disabled]="subItem.disabled">
                          @if (subItem.icon) {
                            <i [class]="'pi ' + subItem.icon" class="submenu-icon"></i>
                          }
                          <span class="submenu-label">{{ subItem.label }}</span>
                          @if (subItem.badge) {
                            <span class="submenu-badge">{{ subItem.badge }}</span>
                          }
                        </a>
                      }
                    </div>
                  }
                }
              }
            </div>
          }
        </div>
      }
    }
  </div>

  <!-- User Profile Section -->
  @if (showUserProfile() && userProfile()) {
    <div class="sidebar-footer">
      @if (collapsed()) {
        <div class="user-profile-collapsed" (click)="toggleUserMenu()">
          <img 
            *ngIf="userProfile()!.avatar" 
            [src]="userProfile()!.avatar" 
            [alt]="userProfile()!.name"
            class="user-avatar">
          <div 
            *ngIf="!userProfile()!.avatar" 
            class="user-avatar user-avatar-initials">
            {{ userInitials() }}
          </div>
        </div>
      } @else {
        <div class="user-profile" (click)="toggleUserMenu()">
          <img 
            *ngIf="userProfile()!.avatar" 
            [src]="userProfile()!.avatar" 
            [alt]="userProfile()!.name"
            class="user-avatar">
          <div 
            *ngIf="!userProfile()!.avatar" 
            class="user-avatar user-avatar-initials">
            {{ userInitials() }}
          </div>
          <div class="user-info">
            <span class="user-name">{{ userProfile()!.name }}</span>
            @if (userProfile()!.role) {
              <span class="user-role">{{ userProfile()!.role }}</span>
            }
          </div>
          <i class="pi pi-chevron-down user-menu-icon"></i>
        </div>
      }
      
      <!-- User Menu Dropdown -->
      @if (isUserMenuOpen() && !collapsed()) {
        <div class="user-menu">
          @for (menuItem of userMenuItems(); track menuItem.label) {
            @if (menuItem.separator) {
              <div class="user-menu-separator"></div>
            } @else {
              <a 
                class="user-menu-item"
                (click)="menuItem.command?.()">
                @if (menuItem.icon) {
                  <i [class]="'pi ' + menuItem.icon" class="user-menu-icon-item"></i>
                }
                <span>{{ menuItem.label }}</span>
              </a>
            }
          }
        </div>
      }
    </div>
  }
</div>
