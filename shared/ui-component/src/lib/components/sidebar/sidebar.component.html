<!-- Sidebar Container -->
<div 
  class="sidebar-container"
  [class.collapsed]="collapsed()"
  [class.dark-theme]="theme() === 'dark'"
  [class.right-position]="position() === 'right'"
  [style.width]="collapsed() ? collapsedWidth() : width()"
>

  <!-- Navigation Sections -->
  <div class="sidebar-content">
    @for (section of displaySections(); track section.title) {
      @if (section.visible !== false) {
        <div class="sidebar-section">
          <!-- Section Header -->
          @if (section.title && !collapsed()) {
            <div 
              class="section-header"
              (click)="onSectionToggle(section)"
              (keydown.enter)="onSectionToggle(section)"
              (keydown.space)="onSectionToggle(section)"
              tabindex="0"
              role="button"
              [attr.aria-label]="'Toggle ' + section.title + ' section'"
              [class.expandable]="section.items.length > 0"
            >
              <span class="section-title">{{ section.title }}</span>
              @if (section.items.length > 0) {
                <i 
                  class="pi section-toggle-icon"
                  [class.pi-chevron-down]="isSectionExpanded(section)"
                  [class.pi-chevron-right]="!isSectionExpanded(section)"
                ></i>
              }
            </div>
          }
          
          <!-- Section Items -->
          @if (!section.title || isSectionExpanded(section) || collapsed()) {
            <div class="section-items">
              @for (item of section.items; track item.label) {
                @if (item.separator) {
                  <div class="menu-separator"></div>
                } @else if (item.visible !== false) {
                  <div 
                    class="menu-item"
                    [class.active]="activeMenuItem() === (item.routerLink || item.label)"
                    [class.disabled]="item.disabled"
                    [class.has-children]="item.items && item.items.length > 0"
                  >
                    <!-- Main Menu Item -->
                    <lib-button
                      [label]="!collapsed() ? item.label : ''"
                      [icon]="item.icon ? 'pi ' + item.icon : undefined"
                      size="small"
                      [text]="true"
                      severity="secondary"
                      [disabled]="item.disabled ?? false"
                      [badge]="item.badge && !collapsed() ? item.badge : undefined"
                      [class.menu-link]="true"
                      [class.active]="activeMenuItem() === (item.routerLink || item.label)"
                      [class.disabled]="item.disabled ?? false"
                      (clickEvent)="!item.disabled && onMenuClick(item)">
                    </lib-button>
                    
                    <!-- Submenu Items -->
                    @if (item.items && item.items.length > 0 && !collapsed()) {
                      <div class="submenu">
                        @for (subItem of item.items; track subItem.label) {
                          <lib-button
                            [label]="subItem.label"
                            [icon]="subItem.icon ? 'pi ' + subItem.icon : undefined"
                            size="small"
                            [text]="true"
                            severity="secondary"
                            [disabled]="subItem.disabled ?? false"
                            [badge]="subItem.badge"
                            [class.submenu-link]="true"
                            [class.disabled]="subItem.disabled ?? false"
                            (clickEvent)="!subItem.disabled && onMenuClick(subItem)">
                          </lib-button>
                        }
                      </div>
                    }
                  </div>
                }
              }
            </div>
          }
        </div>
      }
    }
  </div>

  <!-- User Profile Section -->
  @if (showUserProfile() && userProfile()) {
    <div class="sidebar-footer">
      @if (collapsed()) {
        <lib-user-card
          [user]="{
            name: userProfile()!.name,
            subtitle: userProfile()!.role,
            avatar: userProfile()!.avatar
          }"
          variant="compact"
          size="small"
          [clickable]="true"
          (cardClick)="toggleUserMenu()">
        </lib-user-card>
      } @else {
        <lib-user-card
          [user]="{
            name: userProfile()!.name,
            subtitle: userProfile()!.role,
            avatar: userProfile()!.avatar
          }"
          variant="default"
          size="medium"
          [clickable]="true"
          (cardClick)="toggleUserMenu()">
        </lib-user-card>
      }
      
      <!-- User Menu Dropdown -->
      @if (isUserMenuOpen() && !collapsed()) {
        <div class="user-menu">
          @for (menuItem of userMenuItems(); track menuItem.label) {
            @if (menuItem.separator) {
              <div class="menu-separator"></div>
            } @else {
              <lib-button
                [label]="menuItem.label ?? ''"
                [icon]="menuItem.icon ? 'pi ' + menuItem.icon : undefined"
                size="small"
                [text]="true"
                severity="secondary"
                [class.user-menu-item]="true"
                (clickEvent)="menuItem.command?.()">
              </lib-button>
            }
          }
        </div>
      }
    </div>
  }
</div>
